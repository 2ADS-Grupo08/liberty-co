<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>DashBoard - LibertyCo</title>

  <link rel="shortcut icon" href="styles/assets/logo/logo.png" type="image/jpg" href="/favicon.jpg" />
  <link rel="stylesheet" href="path/to/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="styles/style-dash-armazenamento.css">

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11%22%3E"></script>
  <script src="https://kit.fontawesome.com/9763306bd1.js" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/49bc71d446.js" crossorigin="anonymous"></script>

</head>

<body onload="informacoesLegendaDisco()">
  <div class="content">
    <div class="sidebar">
      <header>
        <div class="logo">
          <img src="styles/assets/logo/logo_side.png" alt="LogoLibertyCo">
        </div>
      </header>
      <a href="dashboard.html">
        <i class="fas fa-stream"></i>
        <span>Visão geral </span>
      </a>
      <a href="dash-cpu.html">
        <i class="fas fa-microchip"></i>
        <span>CPU</span>
        <img class="alerta cpu" src="styles/assets/icone/alerta.png" alt="">
      </a>
      <a href="dash-ram.html">
        <i class="fas fa-sliders-h"></i>
        <span>RAM</span>
        <img class="alerta ram" src="styles/assets/icone/alerta.png" alt="">
      </a>
      <a href="dash-armazenamento.html" class="agora">
        <i class="fas fa-hard-drive"></i>
        <span>Armazenamento</span>
        <img class="alerta disco" src="styles/assets/icone/alerta.png" alt="">
      </a>
      <a href="dash-janela.html">
        <i class="fas fa-window-restore"></i>
        <span>Janela</span>
        <img class="alerta janela" src="styles/assets/icone/alerta.png" alt="">
      </a>
      <a href="dash-contato.html">
        <i class="fas fa-envelope"></i>
        <span>Contato</span>
      </a>
      <div class="saida">
        <a onclick="sair()">
          <i class="fas fa-right-from-bracket"></i>
          <span>Sair</span>
        </a>
      </div>
    </div>
    <div class="container">
      <div class="box-legenda">
        <div class="teste-legenda">
          <div id="voltar" style="display: none;" onclick="setaVoltar()">
            <i class="fa-sharp fa-solid fa-circle-arrow-left"></i>
          </div>
          <div class="conteudo-legenda">
            <div class="hardware">
              <h1>LEGENDA</h1>
              <div class="analytics">
                <div class="box-hardware">
                  <h3>Ideal</h3>
                  <p>Até: <span id="disco_ideal"></span>GB</p>
                  <div class="box-analytics" id="blue"></div>
                </div>
                <div class="linha-vertical"></div>
                <div class="box-hardware">
                  <h3>Urgência</h3>
                  <p>De: <span id="disco_ideal2"></span>GB - Até: <span id="disco_urgencia"></span>GB</p>
                  <div class="box-analytics" id="yellow"></div>
                </div>
                <div class="linha-vertical"></div>
                <div class="box-hardware">
                  <h3>Crítico</h3>
                  <p>Acima de: <span id="disco_urgencia2"></span>GB</p>
                  <div class="box-analytics" id="red"></div>
                </div>
              </div>
            </div>
          </div>
          <div id="avancar" style="display: none;" onclick="setaAvancar()">
            <i class="fa-sharp fa-solid fa-circle-arrow-right"></i>
          </div>
        </div>
      </div>
      <div class="box-container">
        <div class="box-texto">
          <h1>Disco: <span id="disco">1</span></h1>
          <br>
          <h2>Espaço disponível:</h2>
          <h3><span id="espacoDisponivel"></span><b>GB</b></h3>
          <h2>Porcentagem de uso:</h2>
          <h3><span id="porcentagemUso"></span>%</h3>
        </div>

        <div class="box">
          <div class="graficos" style="height: 25vh; width: 35vw; display: flex; flex-direction: column; align-items: center;">
            <canvas id="myChart2"></canvas>
          </div>
          <div class="legenda">
            <p>Dias em que o Disco quase atingiu o limite estipulado
              (por semana)</p>
          </div>
        </div>
      </div>

      <div class="parte2">
        <div class="box2">
          <div class="graficos">
            <canvas id="myChart3" style="height: 40vh; width: 40vw;"></canvas>
          </div>
        </div>

        <div class="listaDados">
          <div class="conteudo">
            <div class="titulo">
              <h1>INFORMAÇÕES</h1>
            </div>
            <div class="info_dono">
              <p><b>Nome:</b> Fernanda Caramico</p>
              <p><b>Cargo:</b> Arquiteto de Edificações</p>
            </div>
            <div class="info_maquina">
              <h1>Máquina</h1>
              <p><b>Hostname:</b> FernandaCaramico</p>
              <p><b>Marca:</b> Dell</p>
              <p><b>Sistema Operacional:</b> Windows</p>
            </div>
            <div class="info_hardware">
              <h1>Hardware</h1>
              <h2>- Memória RAM</h2>
              <p><b>Total:</b> 16GB</p>
              <h2>- CPU</h2>
              <p><b>Nome:</b> 10th Gen Intel(R) Core(TM) i7-10700F @ 2.90GHz</p>
              <h2>- Disco Rígido</h2>
              <p><b>Volume:</b> 1</p>
              <p><b>Capacidade Total:</b> 1TB</p>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
  </div>
</body>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- legenda -->
<script>
  function informacoesLegendaDisco() {
    // var idMaquina = sessionStorage.idMaquina;
    var idMaquina = 3;
    fetch(`/dashboard/informacoesLegendaDisco/${idMaquina}`, { cache: 'no-store' }).then(function (response) {
      if (response.ok) {
        response.json().then(function (resposta) {
          console.log(resposta);
          volumeDisco = resposta;
          validacaoLegenda();
          DefinirEspacoDisponivel();
          mediaUsoDiscoSemana();
        });
      } else {
        console.error('Nenhum dado encontrado ou erro na API');
      }
    })
      .catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
      });
  }

  var nivelCritico = 0;
  var nivelUrgencia = 0;
  var nivelIdeal = 0;
  var disco = 0;
  var volumeDisco;
  var disponivel = 0;
  var porcentagem = 0;

  function validacaoLegenda() {
    if (disco + 1 >= volumeDisco.length) {
      avancar.style.display = "none";
    } if (disco + 1 < volumeDisco.length) {
      avancar.style.display = "block";
    } if ((disco > 0) && (disco + 1 <= volumeDisco.length)) {
      voltar.style.display = "block";
    } if (disco == 0) {
      voltar.style.display = "none";
    }

    nivelCritico = volumeDisco[disco].nivelAlerta * volumeDisco[disco].total / 100;
    nivelIdeal = nivelCritico * 0.8;
    nivelUrgencia = nivelCritico * 0.9;

    disco_ideal.innerHTML = nivelIdeal.toFixed(2);
    disco_ideal2.innerHTML = nivelIdeal.toFixed(2);
    disco_urgencia.innerHTML = nivelUrgencia.toFixed(2);
    disco_urgencia2.innerHTML = nivelUrgencia.toFixed(2);
    console.log("Ideal: " + nivelIdeal);
    console.log("Urgência: " + nivelUrgencia);
    console.log("Crítico: " + nivelCritico);

  }

  function setaVoltar() {
    disco--;
    nivelCritico = volumeDisco[disco].nivelAlerta * volumeDisco[disco].total / 100;
    nivelIdeal = nivelCritico * 0.8;
    nivelUrgencia = nivelCritico * 0.9;

    disco_ideal.innerHTML = nivelIdeal.toFixed(2);
    disco_ideal2.innerHTML = nivelIdeal.toFixed(2);
    disco_urgencia.innerHTML = nivelUrgencia.toFixed(2);
    disco_urgencia2.innerHTML = nivelUrgencia.toFixed(2);
    validacaoLegenda();

    disponivel = volumeDisco[disco].total - volumeDisco[disco].emUso;
    espacoDisponivel.innerHTML = disponivel.toFixed(2);
    porcentagem = volumeDisco[disco].emUso * 100 / volumeDisco[disco].total;
    porcentagemUso.innerHTML = porcentagem.toFixed(1);
    DefinirEspacoDisponivel();

    plotarGraficoMediaUsoDiscoSemanal();
  }

  function setaAvancar() {
    disco++;
    nivelCritico = volumeDisco[disco].nivelAlerta * volumeDisco[disco].total / 100;
    nivelIdeal = nivelCritico * 0.8;
    nivelUrgencia = nivelCritico * 0.9;

    disco_ideal.innerHTML = nivelIdeal.toFixed(2);
    disco_ideal2.innerHTML = nivelIdeal.toFixed(2);
    disco_urgencia.innerHTML = nivelUrgencia.toFixed(2);
    disco_urgencia2.innerHTML = nivelUrgencia.toFixed(2);
    validacaoLegenda();

    disponivel = volumeDisco[disco].total - volumeDisco[disco].emUso;
    espacoDisponivel.innerHTML = disponivel.toFixed(2);
    porcentagem = volumeDisco[disco].emUso * 100 / volumeDisco[disco].total;
    porcentagemUso.innerHTML = porcentagem.toFixed(1);
    DefinirEspacoDisponivel();

    plotarGraficoMediaUsoDiscoSemanal();
  }
</script>

<!-- Espaco disponível no disco por disco -->
<script>
  function DefinirEspacoDisponivel() {
    disponivel = volumeDisco[disco].total - volumeDisco[disco].emUso;
    espacoDisponivel.innerHTML = disponivel.toFixed(2);
    porcentagem = volumeDisco[disco].emUso * 100 / volumeDisco[disco].total;
    porcentagemUso.innerHTML = porcentagem.toFixed(1);
  }

</script>

<!-- média de uso do Disco -->
<script>
  var discoMediaInteiro = [];
  function mediaUsoDiscoSemana() {
    // var idMaquina = sessionStorage.idMaquina;
    var idMaquina = 3;
    fetch(`/dashboard/mediaUsoDiscoSemana/${idMaquina}`, { cache: 'no-store' }).then(function (response) {
      if (response.ok) {
        response.json().then(function (resposta) {
          console.log(resposta);
          var vetorDisco = [];
          var aux = 0;
          for (let i = 0; i < resposta.length; i++) {
            if (i == 0) {
              vetorDisco.push(resposta[0])
            } else {
              if (vetorDisco[0].idComponente == resposta[i].idComponente) {
                vetorDisco.push(resposta[i])
              } else {
                discoMediaInteiro.push(vetorDisco)
                vetorDisco = []
                vetorDisco.push(resposta[i])
              }
            }
          }
          discoMediaInteiro.push(vetorDisco)
          plotarGraficoMediaUsoDiscoSemanal();
        });
      } else {
        console.error('Nenhum dado encontrado ou erro na API');
      }
    })
      .catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
      });
  }

  var bar = new Chart();

  function plotarGraficoMediaUsoDiscoSemanal() {
    bar.destroy();
    var diaSemana = [];
    var mediaDia = [];
    var cores = [];

    for (let i = 0; i < discoMediaInteiro[disco].length; i++) {
      diaSemana.push(discoMediaInteiro[disco][i].Semana)
      mediaDia.push(discoMediaInteiro[disco][i].Media)
      if (discoMediaInteiro[disco][i].Media > nivelUrgencia) {
        cores.push('rgba(255, 51, 70, 0.753)');
      } else if (discoMediaInteiro[disco][i].Media > nivelIdeal) {
        cores.push('rgba(241, 232, 70, 0.8)');
      } else {
        cores.push('rgba(0, 204, 255, 0.753)');
      }
    }

    var cfg_analiseDiasDaSemana = {
      type: 'bar',
      data: {
        labels: diaSemana,
        datasets: [{
          label: '',
          data: mediaDia,
          borderWidth: 1,
          backgroundColor: cores,
        }]
      },
      options: {
        plugins: {
          legend: {
            display: false
          }
        },
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    };

    bar = new Chart(
      document.getElementById('myChart2'),
      cfg_analiseDiasDaSemana
    );
  }
</script>
<!-- grafico 3 -->
<script>
  const ctx3 = document.getElementById('myChart3');

  new Chart(ctx3, {
    type: 'line',
    data: {
      labels: ['12:21:00', '12:21:30', '12:22:00', '12:22:30', '12:23:00', '12:23:30'],
      datasets: [
        {
          label: 'Leitura',
          data: [12, 19, 3, 5, 2, 3],
          borderWidth: 1,
          borderColor: 'rgba(255, 51, 70, 0.753)',
          backgroundColor: 'rgba(255, 51, 70, 0.753)',
        },
        {
          label: 'Escrita',
          data: [5, 15, 20, 10, 15, 16],
          borderColor: 'rgba(0, 204, 255, 0.753)',
          borderWidth: 1,
          backgroundColor: 'rgba(0, 204, 255, 0.753)',
        }
      ]
    },

    options: {
      plugins: {
        title: {
          display: true,
          position: 'bottom',
          text: 'Leitura e escrita do disco em tempo real (a cada 30s)',
          color: 'white',
          padding: {
            top: 40
          },
          font: {
            weight: 'normal',
            size: 18
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>
<script src="https://kit.fontawesome.com/49bc71d446.js" crossorigin="anonymous"></script>

</html>