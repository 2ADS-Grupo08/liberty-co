<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DashBoard - LibertyCo</title>
  <link rel="shortcut icon" href="styles/assets/logo/logo.png" type="image/jpg" href="/favicon.jpg" />
  <link rel="stylesheet" href="styles/style-dash-ram.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.3/dist/sweetalert2.all.min.js"></script>
  <script src="https://kit.fontawesome.com/9763306bd1.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="path/to/font-awesome/css/font-awesome.min.css">
</head>

<body onload="informacoesLegendaRam(), mediaUsoRamSemanaVisaoGeral()">
  <div class="content">
    <div class="sidebar">
      <header>
        <div class="logo">
          <img src="styles/assets/logo/logo_side.png" alt="LogoLibertyCo">
        </div>
      </header>
      <a href="dashboard.html">
        <i class="fas fa-stream"></i>
        <span>Visão geral </span>
      </a>
      <a href="dash-cpu.html">
        <i class="fas fa-microchip"></i>
        <span>CPU</span>
        <img class="alerta cpu" src="styles/assets/icone/alerta.png" alt="">
      </a>
      <a href="dash-ram.html" class="agora">
        <i class="fas fa-sliders-h"></i>
        <span>RAM</span>
        <img class="alerta ram" src="styles/assets/icone/alerta.png" alt="">
      </a>
      <a href="dash-armazenamento.html">
        <i class="fas fa-hard-drive"></i>
        <span>Armazenamento</span>
        <img class="alerta disco" src="styles/assets/icone/alerta.png" alt="">
      </a>
      <a href="dash-janela.html">
        <i class="fas fa-window-restore"></i>
        <span>Janela</span>
        <img class="alerta janela" src="styles/assets/icone/alerta.png" alt="">
      </a>
      <a href="dash-contato.html">
        <i class="fas fa-envelope"></i>
        <span>Contato</span>
      </a>
      <div class="saida">
        <a onclick="sair()">
          <i class="fas fa-right-from-bracket"></i>
          <span>Sair</span>
        </a>
      </div>
    </div>
    <div class="container">

      <div class="box-legenda">
        <div class="box-legenda">
          <div class="conteudo-legenda">
            <h1>LEGENDA</h1>
            <div class="hardware">
              <div class="box-hardware">
                <h3>Ideal</h3>
                <p>Até: <span id="ram_ideal"></span>GB</p>
                <div class="box-analytics" id="blue"></div>
              </div>
              <div class="linha-vertical"></div>
              <div class="box-hardware">
                <h3>Urgência</h3>
                <p>De: <span id="ram_ideal2"></span>GB - Até: <span id="ram_urgencia"></span>GB</p>
                <div class="box-analytics" id="yellow"></div>
              </div>
              <div class="linha-vertical"></div>
              <div class="box-hardware">
                <h3>Crítico</h3>
                <p>Acima de: <span id="ram_urgencia2"></span>GB</p>
                <div class="box-analytics" id="red"></div>
              </div>
            </div>
          </div>
        </div>
      </div>


      <div class="box-container">
        <div class="box">
          <div class="graficos">
            <div>
              <canvas id="bar_mediaCpu" style="height: 25vh; width: 35vw;"></canvas>
            </div>

          </div>
          <div class="legenda">
            <p>Uso da memória RAM da última semana</p>
          </div>
        </div>
        <div class="box">
          <div class="graficos">
            <canvas id="dought_diasDaSemana" style="width: 20vw; height: 15vh;"></canvas>
          </div>
          <div class="legenda">
            <p>Dias em que o uso da RAM ultrapassou o limite<br>
              (por semana)</p>
          </div>
        </div>
      </div>

      <div class="parte2">
        <div class="box2">
          <div class="graficos">
            <canvas id="myChart3" style="height: 40vh; width: 40vw;"></canvas>

          </div>
          <!-- <div class="legenda">
            <p>Uso da memória RAM a cada 30 segundos</p>
          </div> -->
        </div>

        <div class="listaDados">
          <div class="conteudo">
            <div class="titulo">
              <h1>INFORMAÇÕES</h1>
            </div>
            <div class="info_dono">
              <p><b>Nome: </b><span id="nome_txt"></span> <span id="sobrenome_txt"></span></p>
            </div>
            <div class="info_maquina">
              <h1>Máquina</h1>
              <p><b>Hostname: </b><span id="hostname_txt"></span></p>
              <p><b>Sistema Operacional: </b><span id="so_txt"></span></p>
            </div>
            <div class="info_hardware">
              <h1>Hardware</h1>
              <h2>- Memória RAM</h2>
              <p><b>Total: </b><span id="totalRam_txt"></span>GB</p>
              <h2>- CPU</h2>
              <p><b>Nome: </b><span id="nomeCpu_txt"></span></p>
              <h2>- Disco Rígido</h2>
              <p><b>Volume: </b><span id="volume_txt"></span></p>
              <p><b>Capacidade Total:</b><span id="totalDisco_txt"></span></p>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
  </div>
</body>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- legenda -->
<script>
  function informacoesLegendaRam() {
    // var idMaquina = sessionStorage.idMaquina;
    var idMaquina = 3;
    fetch(`/dashboard/informacoesLegendaRam/${idMaquina}`, { cache: 'no-store' }).then(function (response) {
      if (response.ok) {
        response.json().then(function (resposta) {
          console.log(resposta);
          validacaoLegenda(resposta);
        });
      } else {
        console.error('Nenhum dado encontrado ou erro na API');
      }
    })
      .catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
      });
  }

  var nivelCritico = 0;
  var nivelUrgencia = 0;
  var nivelIdeal = 0;

  function validacaoLegenda(resposta) {
    nivelCritico = resposta[0].nivelAlerta * resposta[0].total / 100;
    nivelIdeal = nivelCritico * 0.8;
    nivelUrgencia = nivelCritico * 0.9;

    ram_ideal.innerHTML = nivelIdeal.toFixed(2);
    ram_ideal2.innerHTML = nivelIdeal.toFixed(2);
    ram_urgencia.innerHTML = nivelUrgencia.toFixed(2);
    ram_urgencia2.innerHTML = nivelUrgencia.toFixed(2);
  }
</script>

<!-- média dos ultimos 7 dias da ram -->
<script>
  function mediaUsoRamSemanaVisaoGeral() {
    // var idMaquina = sessionStorage.idMaquina;
    var idMaquina = 3;
    fetch(`/dashboard/mediaUsoRamSemanaVisaoGeral/${idMaquina}`, { cache: 'no-store' }).then(function (response) {
      if (response.ok) {
        response.json().then(function (resposta) {
          console.log(resposta);
          validacaoSemana(resposta);
          plotarGraficoSemanalRamVisaoGeral(resposta);
          // diasCpuLimite();
        });
      } else {
        console.error('Nenhum dado encontrado ou erro na API');
      }
    })
      .catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
      });
  }

  function plotarGraficoSemanalRamVisaoGeral(resposta) {
    //Média diária do uso da cpu dos últimos 7 dias
    var diaSemana = [];
    var mediaDia = [];
    var cores = [];
    for (let i = 0; i < resposta.length; i++) {
      diaSemana.push(resposta[i].Semana);
      mediaDia.push(resposta[i].Media);
      if (resposta[i].Media > nivelUrgencia) {
        diasCritico++;
        cores.push('rgba(255, 51, 70, 0.753)');
      } else if (resposta[i].Media > nivelIdeal) {
        diasUrgencia++;
        cores.push('rgba(241, 232, 70, 0.8)');
      } else {
        diasIdeal++;
        cores.push('rgba(0, 204, 255, 0.753)');
      }
    }

    var cfg_mediaCpu = {
      type: 'bar',
      data: {
        labels: diaSemana,
        datasets: [{
          label: '',
          data: mediaDia,
          borderWidth: 1,
          backgroundColor: cores
        }]
      },
      options: {
        plugins: {
          legend: {
            display: false
          },
          datalabels: {
            color: 'red' // Define a cor da label como vermelho
          }
        },
        scales: {
          y: {
            beginAtZero: true
          }
        },
        legend: {
          labels: {
            usePointStyle: false // Remove o quadrado colorido da legenda
          }
        }
      }
    }
    
    const bar_mediaSemanalRam = new Chart(
      document.getElementById('bar_mediaCpu'),
      cfg_mediaRam,
    );

  }

  function validacaoSemana(resposta) {
    for (var i = 0; i < resposta.length; i++) {
      if (resposta[i].Semana == "Monday") {
        resposta[i].Semana = "Segunda"
      } else if (resposta[i].Semana == "Tuesday") {
        resposta[i].Semana = "Terça"
      } else if (resposta[i].Semana == "Wednesday") {
        resposta[i].Semana = "Quarta"
      } else if (resposta[i].Semana == "Thursday") {
        resposta[i].Semana = "Quinta"
      } else if (resposta[i].Semana == "Friday") {
        resposta[i].Semana = "Sexta"
      } else if (resposta[i].Semana == "Saturday") {
        resposta[i].Semana = "Sábado"
      } else if (resposta[i].Semana == "Sunday") {
        resposta[i].Semana = "Domingo"
      }
    }
  }
</script>

<!-- Dias que o uso da CPU ultrapassou o limite (por semana) -->
<!-- <script>
  var diasCritico = 0;
  var diasUrgencia = 0;
  var diasIdeal = 0;
  var vt_dias = [];

  function diasCpuLimite() {
    vt_dias.push(diasIdeal);
    vt_dias.push(diasUrgencia);
    vt_dias.push(diasCritico);

    var cfg_analiseDiasDaSemana = {
      type: 'doughnut',
      data: {
        labels: ['Ideal', 'Urgência', 'Crítico'],
        datasets: [{
          label: 'Dias',
          backgroundColor: ['rgba(0, 204, 255, 0.753)', 'rgba(241, 232, 70, 0.8)', 'rgba(255, 51, 70, 0.753)'],
          data: vt_dias,
          borderWidth: 0.75
        }]
      },
      options: {
        maintainAspectRatio: false,
        circumference: 180,
        rotation: -90,
        cutout: 30
      }
    };

    const dought_analiseDiasDaSemana = new Chart(
      document.getElementById('dought_diasDaSemana'),
      cfg_analiseDiasDaSemana
    );
  }

</script> -->

<script>
  var cfg_analiseDiasDaSemana = {
    type: 'doughnut',
    data: {
      labels: ['Ideal', 'Urgência', 'Crítico'],
      datasets: [{
        label: 'Dias',
        backgroundColor: ['rgba(0, 204, 255, 0.753)', 'rgba(241, 232, 70, 0.8)', 'rgba(255, 51, 70, 0.753)'],
        data: [2, 1, 3],
        borderWidth: 0.75
      }]
    },
    options: {
      maintainAspectRatio: false,
      circumference: 180,
      rotation: -90,
      cutout: 30
    }
  };
</script>
<script>
  const dought_analiseDiasDaSemana = new Chart(
    document.getElementById('dought_diasDaSemana'),
    cfg_analiseDiasDaSemana
  );
</script>
<!-- grafico 3 -->
<script>
  const ctx3 = document.getElementById('myChart3');

  new Chart(ctx3, {
    type: 'line',
    data: {
      labels: ['12:21:00', '12:21:30', '12:22:00', '12:22:30', '12:23:00'],
      datasets: [{
        label: '',
        data: [1, 2, 2.1, 3, 2.5],
        borderWidth: 1
      }]
    },
    options: {
      plugins: {
        legend: {
          display: false
        },
        title: {
          display: true,
          position: 'bottom',
          text: 'Uso da memória RAM em tempo real (a cada 30s)',
          color: 'white',
          padding: {
            top: 40
          },
          font: {
            weight: 'normal',
            size: 18
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>

</html>